---
title: "Model"
format:
  html:
    code-fold: true
---

```{r}

#library(reticulate)
#use_virtualenv("C:\\Users\\C25Jillian.Howe\\Documents\\Math 378\\Stats 378 Final Proh\\.\\venv\\Scripts\\activate")

#py_config()
#use_python("C:.venv/Scripts/python.exe", required = TRUE)
#use_virtual(".venv")
#repl_python()
```

```{python}
import duckdb
import docker
from palmerpenguins import penguins
from pandas import get_dummies
import numpy as np
from sklearn.linear_model import LinearRegression
from sklearn import preprocessing
from pins import board_folder    #L2
from vetiver import vetiver_pin_write, VetiverModel, VetiverAPI, prepare_docker #L2
```

## Get Data

```{python}
df = penguins.load_penguins().dropna()

df.head(3)
```

## Define Model and Fit

```{python}
X = get_dummies(df[['bill_length_mm', 'species', 'sex']], drop_first = True)
y = df['body_mass_g']

model = LinearRegression().fit(X, y)
```

## Get some information

```{python}
print(f"R^2 {model.score(X,y)}")
print(f"Intercept {model.intercept_}")
print(f"Columns {X.columns}")
print(f"Coefficients {model.coef_}")
```

```{python}
v = VetiverModel(model, model_name="penguin_model")

from pins import board_folder
model_board = board_folder(
  "data/model", 
  allow_pickle_read = True
)
vetiver_pin_write(model_board, v)
```

```{python}
app = VetiverAPI(v, check_prototype = True)
```

```{python}

con = duckdb.connect('my-db.duckdb')
df = penguins.load_penguins()
con.execute('DROP TABLE IF EXISTS penguins')
con.execute('CREATE TABLE penguins AS SELECT * FROM df')
con.close()
```

```{python}
con = duckdb.connect('my-db.duckdb')
df = con.execute("SELECT * FROM penguins").fetchdf().dropna()
con.close()
```

```{python}
#prepare_docker(model_board, 'penguin_model')
```
